# Test Fixtures 测试辅助工具

## 模块职责
本目录 (`tests/fixtures/`) 存放所有用于支持自动化测试的辅助工具和资源。这包括测试数据的生成器 (Factories)、模拟对象 (Mocks/Stubs)、共享的测试辅助函数 (Helpers)，以及静态的预定义测试数据集。其目标是提高测试代码的可维护性、可读性和复用性。

## 测试工具类型
-   **测试数据工厂 (Test Data Factories)**:
    *   **用途**: 按需生成结构化的测试数据，支持不同场景（如有效数据、边界数据、大量数据）。
    *   **能力**: 提供创建单个或批量测试数据对象（如 `EventLogRecord`, `UserConfig`）的方法，允许覆盖默认值。
-   **模拟对象 (Mock Objects)**:
    *   **用途**: 替换真实的外部依赖（如 Chrome API、数据库服务、网络请求），以便在测试中隔离被测单元，并控制依赖行为。
    *   **能力**: 提供对外部接口的模拟实现，允许设置预期返回值、捕获调用参数等。
-   **测试辅助函数 (Test Helpers)**:
    *   **用途**: 封装通用的测试设置逻辑、清理逻辑、自定义断言、或与测试流程相关的复杂操作。
    *   **能力**: 例如，提供设置/重置测试数据库、控制模拟时间、执行复杂的断言逻辑等函数。
-   **静态测试数据 (Static Test Data)**:
    *   **用途**: 存储一些预定义的、在多个测试用例中可能复用的 JSON 或其他格式的测试数据。
    *   **能力**: 提供一组固定的输入数据或预期的输出数据。

## 目录结构 (示例)
```
fixtures/
├── README.md               // 本文档
├── data/                   // 存放静态测试数据 (如 .json 文件)
│   └── sample-events.json
├── factories/              // 测试数据工厂 (原 database/test-data-factory.ts 等)
│   └── event-factory.ts
├── mocks/                  // 模拟对象的实现
│   └── chrome-api-mock.ts
└── helpers/                // 通用测试辅助函数
    ├── assertion-helpers.ts
    └── test-setup-helpers.ts
```
*具体实现位于各 `.ts` 或 `.json` 文件中。*

## 核心概念与实践

### 测试数据生成
-   **原则**: 生成的数据应具有确定性（相同输入产生相同输出）、多样性（覆盖不同场景）和一定的真实性。
-   **工具**: 通常通过编写专门的工厂类或函数来实现，例如 `EventDataFactory.createValidEvent()`。

### 模拟外部依赖
-   **原则**: 模拟对象应尽可能简单，仅模拟被测代码直接交互的部分；其行为应与真实对象在测试场景下的预期行为一致；易于验证交互（如调用次数、参数）。
-   **工具**: 利用测试框架（如 Vitest 的 `vi.fn()`, `vi.mock()`) 或专门的模拟库。

### 辅助函数的运用
-   **原则**: 辅助函数应遵循单一职责，易于理解和复用，并有良好的错误处理。
-   **示例**: 包括自定义断言 (`expect(data).toBeValidEventRecord()`)、环境设置函数 (`async setupTestDb()`)、时间控制函数 (`mockSystemTime(newDate)`)。

## 最佳实践
-   **数据生成**:
    *   追求确定性、多样性、真实性和可控性。
    *   提供便捷的方法来覆盖默认生成值，以适应特定测试场景。
-   **模拟对象**:
    *   保持模拟的最小化和针对性。
    *   确保模拟行为的一致性和可验证性。
    *   易于重置模拟对象的状态以保证测试隔离。
-   **辅助函数**:
    *   坚持单一职责原则，使其易于复用和理解。
    *   确保有适当的错误处理和清晰的命名。

## 与其他测试的关系
-   **支持所有测试类型**: 本目录提供的工具和资源旨在为单元测试、集成测试、边界测试和性能测试等所有类型的自动化测试提供支持。
-   **测试数据管理**: 作为测试数据的集中管理和生成中心。
-   **测试环境一致性**: 辅助函数有助于在不同测试间建立和清理一致的测试环境。
-   **提高测试效率与可读性**: 通过封装通用逻辑，减少测试代码的重复，提高其表达力和可维护性。
