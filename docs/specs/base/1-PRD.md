# 01-产品需求文档(PRD).md

## 1. 文档信息

| 属性 | 内容 |
| :--- | :--- |
| **文档名称** | Chrome 网页时间追踪扩展 - 产品需求文档 |
| **文档版本** | v2.1.2 |
| **创建日期** | 2025年6月17日 |
| **目标受众** | 产品经理、业务分析师、项目干系人 |
| **依赖文档** | 无（顶层文档） |

## 2. 文档范围与边界 (Scope and Boundaries)

为确保各文档职责清晰，本PRD的范围严格限定于定义产品的业务需求。

**本文档包含 (In Scope):**
*   产品愿景与用户价值。
*   功能性需求 (Functional Requirements)。
*   核心业务规则 (Core Business Rules)。
*   业务层面的验收标准 (Business-level Acceptance Criteria)。

**本文档不包含 (Out of Scope):**
*   系统架构与技术选型。
*   详细的用户界面(UI)与交互(UX)设计。
*   详细的API规格与数据结构。
*   量化的非功能性需求指标。
*   具体的配置参数数值（将在《配置规格说明书 (CSPEC)》中定义）。

## 3. 产品概述

### 3.1 产品愿景
为用户提供一个**准确、可信赖、由用户完全掌控**的网页时间追踪工具，帮助用户了解自己的网络使用习惯，从而提升时间管理意识和工作效率。

### 3.2 核心价值主张
- **准确性**: 采用"单一焦点"计时原则，确保在任何时刻只追踪用户唯一关注的活动，杜绝并行计时导致的数据失真。
- **可靠性**: 数据持久化存储，并通过周期性的进度保存和异常恢复能力，最大限度保障数据安全。
- **隐私性**: 所有数据100%本地存储，用户拥有对不同类型数据的分类管理和生命周期的完全所有权。
- **跨设备一致性**: 用户配置和偏好设置在不同设备间自动同步，提供无缝的使用体验。

## 4. 用户画像与需求场景

### 4.1 主要用户群体
- **知识工作者**: 需要了解在各个网站的学习和工作时间分配。
- **学生群体**: 希望监控自己的学习专注度和娱乐时间占比。
- **多设备用户**: 在多台电脑间工作，希望配置和偏好保持一致。

### 4.2 核心使用场景
- **场景1**: 用户想知道某个页面的"打开时长"和"实际专注时长"的差异，以评估自己的时间利用效率。
- **场景2**: 用户正在一个需要数小时才能完成的在线任务上工作，他希望能够实时查看自己已投入的时间进展。
- **场景3**: 作为一名注重隐私的用户，他希望将原始活动日志的保留时间设置为最短，以减少个人数据足迹。
- **场景4**: 用户在新的工作电脑上安装扩展后，希望之前设置的数据保留策略、界面偏好等配置自动同步，无需重新配置。

## 5. 数据分类与管理原则

### 5.1 核心数据分类
系统必须明确区分和分别管理以下三种性质不同的数据：

**用户配置数据 (User Configuration Data)**
- **定义**: 用户的个人偏好设置、保留策略、界面主题等配置信息
- **特性**: 长期稳定、用户期望在不同设备间保持一致的使用体验、数据量小
- **生命周期**: 由用户主动管理，通常长期保留

**原始事件日志 (Raw Event Logs)**
- **定义**: 用户行为的原始记录，未经聚合的详细活动数据
- **特性**: 数据量大、按策略清理、用户通常只在特定设备上进行详细分析
- **生命周期**: 根据用户设定的保留策略进行管理

**聚合统计数据 (Aggregated Statistics)**
- **定义**: 经过计算处理的最终使用统计和分析结果
- **特性**: 持久保存、用于查询展示、数据价值高
- **生命周期**: 通常永久保留，用户可选择导出备份

## 6. 功能性需求

### FR-1：网页时间统计
**用户故事**: 作为一名用户，我希望系统能够准确追踪我真正在关注的内容，并区分"打开时长"和"专注时长"，以便我能识别并量化时间消耗的"黑洞"，从而优化我的工作与学习模式。

**业务规则**:
1.  **核心指标定义**: 系统必须统计并区分以下两个核心指标：打开时间 (Open Time)和活跃时间 (Active Time)。
2.  **单一焦点原则**: 系统必须遵循"单一焦点"原则，在任何时刻，只应将在用户唯一关注的那个页面上花费的时间计为"活跃时间"。
3.  **专注情景智能识别**: 系统需能智能区分"主动交互"和"被动媒体消费"两种核心的专注情景。
4.  **数据记录粒度**: 系统的最小统计单元必须是包含完整路径和关键参数的完整URL。
5.  **主机名规范化**: 系统需对主机名进行规范化处理，保留有区分意义的子域名。
6.  **过滤规则**: 系统需能过滤掉无统计意义的浏览器内部页面和URL中的营销跟踪参数。
7.  **长期会话进度保障**: 
    - **活跃时间保障**: 当用户在单个页面上连续专注超过预设阈值时，系统必须周期性地保存其活跃时间进度并立即触发增量数据聚合，确保用户可以近乎实时地查询到长时间任务的最新耗时。
    - **打开时间保障**: 对于持续打开超过预设时长阈值的标签页，系统必须周期性地保存其打开时间进度并触发数据聚合，确保长期会话的累积时长能够被实时查询。

### FR-2：数据查询与分析
**用户故事**: 作为一名用户，我希望能方便地查询和分析我的时间数据，既能看到宏观趋势，也能深入到具体任务，以便我能发现自己的行为模式并做出调整。

**功能描述**:
- 查询结果必须同时提供**打开时间**和**活跃时间**两个指标。
- 用户必须能够分层级查看数据，从宏观的主域名统计，到中观的主机名分析，再到微观的具体页面耗时。

**验收标准**:
- **场景：验证主域名时长聚合的正确性**
    - **Given** 用户在`site.com/page1`上花费了10分钟活跃时间，并在`sub.site.com/pageA`上花费了20分钟活跃时间。
    - **When** 用户查询`site.com`这个主域名的统计数据。
    - **Then** 系统展示的`site.com`的总活跃时间**必须**为30分钟。

### FR-3：数据持久化与可靠性
**用户故事**: 作为一名用户，我希望我的数据能够被安全地保存，即使浏览器意外关闭，我也能信赖这个工具的数据不会轻易丢失。

**功能描述**:
- 所有时间数据必须持久化存储在用户本地。
- 系统必须具备异常恢复能力。
- 系统需提供清晰的存储空间管理机制，包括空间使用情况展示和预警。

### FR-4A：用户配置管理
**用户故事**: 作为一名多设备用户，我希望我的个人偏好设置能在不同设备间保持一致，这样我就不需要在每台新设备上重新配置。

**功能描述**:
- 系统必须提供用户配置的跨设备同步功能。
- 支持用户配置的导出和导入，用于备份和手动迁移。

**业务规则**:
1. **同步范围**: 包括但不限于数据保留策略、界面主题、过滤规则自定义、显示偏好等所有用户可配置项。
2. **同步时机**: 配置变更后必须立即同步，新设备安装后必须自动获取已有配置。
3. **冲突处理策略**: 
   - **覆盖原则**: 当检测到配置冲突时，系统采用简单的整体覆盖策略，以最后修改时间最新的完整配置对象替换旧配置。
   - **用户透明性**: 系统必须在用户界面中明确展示当前配置的最后同步时间和来源设备信息。
   - **变更通知**: 当配置被覆盖时，系统必须通过明显的用户界面提示告知用户哪些设置可能已被更改，并提供查看变更详情的选项。

**验收标准**:
- **场景：配置覆盖的用户感知**
    - **Given** 用户在设备A上修改了数据保留策略，在设备B上修改了界面主题。
    - **When** 设备间发生配置同步冲突。
    - **Then** 系统应采用时间戳最新的完整配置覆盖旧配置。
    - **And** 系统必须在用户界面显著位置提示"配置已从[设备名称]同步，上次更新时间：[时间戳]"。
    - **And** 用户必须能够查看具体哪些配置项发生了变更。

### FR-4B：原始日志管理
**用户故事**: 作为一名注重隐私的用户，我希望能控制我的详细活动日志的保留时长，以便在数据分析的深度和个人隐私之间做出权衡。

**功能描述**:
- 系统必须提供原始事件日志的生命周期管理功能。
- 支持原始日志的导出功能，用于数据分析师进行深度的工作模式研究、开发者调试个人时间管理策略或学术研究需求。

**业务规则**:
1. **保留策略选项**: 用户可选择的保留策略应至少包括："聚合后立即删除"、"保留预设短期"、"保留预设长期"、"永久保留"。
2. **默认策略**: 系统必须以"聚合后立即删除"作为默认策略，以最大限度地保护用户隐私和节省存储空间。
3. **策略变更规则**: 当用户变更数据保留策略时：
   - **缩短保留期策略**: 当用户将保留策略变更为一个更短的周期时，系统必须在用户明确确认后，异步执行一次清理任务。
   - **延长保留期策略**: 当用户将保留策略变更为一个更长的周期时，无需对现有数据进行特殊操作。
   - **用户确认机制**: 对于可能导致数据删除的策略变更，系统必须明确展示影响范围并要求用户确认。

### FR-4C：统计数据备份
**用户故事**: 作为一名用户，我希望能完全控制我的统计数据，可以随时导出备份，并在需要时恢复，以确保数据的安全和可迁移性。

**功能描述**:
- 支持按时间范围导出或全量导出聚合统计数据为结构化的、带版本信息的文件。
- 支持统计数据的导入和智能合并。

**业务规则**:
- **核心合并规则**: 当导入的数据与本地数据在同一统计维度上发生冲突时，业务规则是：**必须以数据记录的最后更新时间为准，保留最新的记录**。

**验收标准**:
- **场景：验证导入数据时的智能合并**
    - **Given** 本地已存在`example.com`在某日有10分钟的记录，其`last_updated`为上午9点。
    - **When** 用户导入一个文件，该文件也包含`example.com`在当日有15分钟的记录，其`last_updated`为下午3点。
    - **Then** 导入完成后，系统中`example.com`当日的记录应更新为**15分钟**，而不是累加为25分钟。

## 7. 约束条件

- **技术约束**: 必须作为Chrome浏览器扩展运行，并受限于其API能力和安全策略。
- **业务约束**: 项目必须开源，且不应包含任何形式的广告、商业推广或未经用户明确同意的数据收集行为。

---
