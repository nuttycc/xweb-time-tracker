# 05-配置规格说明书(CSPEC).md

## 1. 文档信息

| 属性 | 内容 |
| --- | --- |
| **文档名称** | Chrome 网页时间追踪扩展 - 配置规格说明书 |
| **文档版本** | v1.0.2 (规则补充版) |
| **创建日期** | 2025年6月18日 |
| **目标受众** | 开发工程师、测试工程师、运维人员、技术支持 |
| **依赖文档** | `01-产品需求文档(PRD).md` (v2.1.2)<br>`03-高级设计文档(HLD).md` (v2.0.1) |

## 2. 文档范围与目的

本配置规格说明书（CSPEC）作为项目中所有可配置参数的权威参考文档，定义了每个参数的“是什么”（定义）、“为什么”（存在理由）和“如何约束”（取值范围）。本文档为开发团队提供了一个清晰、一致的“单一事实来源”，确保系统行为的可预测性和可维护性。

## 3. 配置核心原则

- **稳定性优先**：默认值必须以系统的长期稳定性和性能为首要考量。
- **用户体验**：面向用户的配置项应易于理解，避免暴露过多的技术细节。
- **隐私保护**：涉及数据处理的参数，其默认值必须遵循最严格的隐私保护原则。

## 4. 详细参数规格

### 4.1 时间追踪引擎参数

| 参数名 | 具体说明 |
| --- | --- |
| **`INACTIVE_TIMEOUT_DEFAULT`** | - **描述**: 普通内容的无交互超时阈值，超过此时间后Active Time计时自动终止。<br>- **关联需求**: PRD-FR1 (单一焦点原则), SRS-SYS-FR-1.2 (专注情景识别)。<br>- **数据类型**: `number`<br>- **默认值**: `30000` (30秒，单位：毫秒)<br>- **取值范围**: `5000 - 300000` (5秒 - 5分钟)<br>- **用户可配置**: `true`<br>- **调整策略与影响**: 增加此值可更准确地捕获深度思考等低交互场景，但可能过度计算非活跃时间；减少此值提高计时精确性，但可能中断连续的专注会话。 |
| **`INACTIVE_TIMEOUT_MEDIA`** | - **描述**: 播放音频内容时的无交互超时阈值，适用于视频学习等被动消费场景。<br>- **关联需求**: PRD-FR1 (专注情景智能识别), SRS-SYS-FR-1.2。<br>- **数据类型**: `number`<br>- **默认值**: `300000` (5分钟，单位：毫秒)<br>- **取值范围**: `60000 - 1800000` (1分钟 - 30分钟)<br>- **用户可配置**: `true`<br>- **调整策略与影响**: 增加此值更好地支持长视频内容学习，但可能计入非专注的背景音频时间；减少此值提高计时准确性，但可能中断有效的学习会话。 |
| **`SCROLL_THRESHOLD_PIXELS`** | - **描述**: scroll事件触发Active Time所需的最小滚动像素距离。<br>- **关联需求**: PRD-FR1 (交互驱动原则)。<br>- **数据类型**: `number`<br>- **默认值**: `20`<br>- **取值范围**: `5 - 100`<br>- **用户可配置**: `false`<br>- **调整策略与影响**: 增加此值可过滤意外的微小滚动，但可能忽略有效的浏览行为；减少此值提高响应敏感度，但可能增加误触发。 |
| **`MOUSEMOVE_THRESHOLD_PIXELS`** | - **描述**: mousemove事件触发Active Time所需的最小鼠标移动像素距离。<br>- **关联需求**: PRD-FR1 (交互驱动原则)。<br>- **数据类型**: `number`<br>- **默认值**: `10`<br>- **取值范围**: `3 - 50`<br>- **用户可配置**: `false`<br>- **调整策略与影响**: 增加此值可减少意外触发，但可能忽略精细的鼠标操作；减少此值提高敏感度，但可能产生过多的噪音事件。 |

### 4.2 URL过滤规则参数 (新增)

| 参数名 | 具体说明 |
| --- | --- |
| **`IGNORED_HOSTNAMES_DEFAULT`** | - **描述**: 定义一个默认的主机名列表，所有匹配此列表的页面都将被时间追踪引擎完全忽略。<br>- **关联需求**: PRD-FR1 (过滤规则), SRS-SYS-FR-1.4。<br>- **数据类型**: `string[]`<br>- **默认值**: `['newtab', 'extensions', 'localhost']`<br>- **用户可配置**: `true` (允许用户追加自定义规则)<br>- **调整策略与影响**: 用户可以添加内部开发或测试环境的域名，以避免统计不必要的数据。 |
| **`IGNORED_QUERY_PARAMS_DEFAULT`** | - **描述**: 定义一个默认的URL查询参数列表。在进行URL统计时，所有匹配此列表的参数都将被从URL中移除，以确保URL的规范性和统计的准确性。<br>- **关联需求**: PRD-FR1 (过滤规则), SRS-SYS-FR-1.4。<br>- **数据类型**: `string[]`<br>- **默认值**: `['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'fbclid', 'gclid', 'mc_cid', 'mc_eid']`<br>- **用户可配置**: `true` (允许用户追加自定义规则)<br>- **调整策略与影响**: 覆盖了大多数常见的营销和广告跟踪参数，能有效净化URL数据。 |

### 4.3 数据生命周期与存储参数

| 参数名 | 具体说明 |
| --- | --- |
| **`RETENTION_POLICY_DEFAULT`** | - **描述**: 原始事件日志的默认保留策略。<br>- **关联需求**: PRD-FR4B (原始日志管理), SRS-SYS-FR-4B.1。<br>- **数据类型**: `string`<br>- **默认值**: `'immediate'`<br>- **取值范围**: `['immediate', 'short', 'long', 'permanent']`<br>- **用户可配置**: `true`<br>- **调整策略与影响**: 'immediate'最大化隐私保护和存储效率；'permanent'支持详细行为分析但增加存储压力和隐私风险。 |
| **`RETENTION_POLICY_SHORT_DAYS`** | - **描述**: 短期保留策略对应的具体天数。<br>- **关联需求**: PRD-FR4B (原始日志管理)。<br>- **数据类型**: `number`<br>- **默认值**: `7`<br>- **取值范围**: `1 - 30`<br>- **用户可配置**: `false`<br>- **调整策略与影响**: 增加天数提供更长的分析窗口，但增加存储占用；减少天数节省存储空间，但限制分析深度。 |
| **`RETENTION_POLICY_LONG_DAYS`** | - **描述**: 长期保留策略对应的具体天数。<br>- **关联需求**: PRD-FR4B (原始日志管理)。<br>- **数据类型**: `number`<br>- **默认值**: `30`<br>- **取值范围**: `7 - 365`<br>- **用户可配置**: `false`<br>- **调整策略与影响**: 增加天数支持长期行为模式分析，但显著增加存储需求；减少天数控制存储增长，但限制深度分析能力。 |
| **`STORAGE_WARNING_THRESHOLD_PERCENT`** | - **描述**: 触发存储空间预警的使用率百分比阈值。<br>- **关联需求**: SRS-NFR-2.1 (存储管理)。<br>- **数据类型**: `number`<br>- **默认值**: `80`<br>- **取值范围**: `50 - 95`<br>- **用户可配置**: `false`<br>- **调整策略与影响**: 增加此值延迟预警但增加存储耗尽风险；减少此值提供更早警告，但可能产生不必要的用户干扰。 |

### 4.4 Checkpoint与聚合任务参数

| 参数名 | 具体说明 |
| --- | --- |
| **`CHECKPOINT_ACTIVE_TIME_THRESHOLD`** | - **描述**: 触发Active Time checkpoint的连续专注时长阈值。<br>- **关联需求**: PRD-FR1 (长期会话进度保障), SRS-SYS-FR-1.7。<br>- **数据类型**: `number`<br>- **单位**: 小时<br>- **默认值**: `2`<br>- **取值范围**: `0.5 - 8`<br>- **用户可配置**: `true`<br>- **调整策略与影响**: 减少此值提供更频繁的进度保存，但增加系统开销；增加此值减少checkpoint频率，但增加崩溃时的数据丢失风险。 |
| **`CHECKPOINT_OPEN_TIME_THRESHOLD`** | - **描述**: 触发Open Time checkpoint的持续打开时长阈值。<br>- **关联需求**: PRD-FR1 (长期会话进度保障), SRS-SYS-FR-1.7。<br>- **数据类型**: `number`<br>- **单位**: 小时<br>- **默认值**: `4`<br>- **取值范围**: `1 - 24`<br>- **用户可配置**: `true`<br>- **调整策略与影响**: 减少此值为长期打开的标签页提供更及时的数据更新，但增加处理开销；增加此值减少checkpoint频率，但可能延迟数据可见性。 |
| **`CHECKPOINT_INTERVAL`** | - **描述**: 用于周期性唤醒系统，以检查所有长期会话（包括Active Time和Open Time）是否已达到其各自阈值的任务执行间隔。<br>- **关联需求**: SRS-SYS-FR-1.6 (周期性任务调度器)。<br>- **数据类型**: `number`<br>- **单位**: 分钟<br>- **默认值**: `30`<br>- **取值范围**: `5 - 120`<br>- **用户可配置**: `false`<br>- **调整策略与影响**: 减少间隔提高checkpoint响应性，但增加后台任务频率；增加间隔减少系统负载，但可能延迟长期会话的数据更新。 |
| **`AGGREGATION_INTERVAL`** | - **描述**: 数据聚合任务的执行间隔。<br>- **关联需求**: SRS-NFR-1.2 (后台处理性能)。<br>- **数据类型**: `number`<br>- **单位**: 分钟<br>- **默认值**: `60`<br>- **取值范围**: `10 - 240`<br>- **用户可配置**: `false`<br>- **调整策略与影响**: 减少间隔提高数据实时性，但增加CPU占用和电池消耗；增加间隔节省系统资源，但可能延迟统计数据更新。 |

### 4.5 用户界面与体验参数

| 参数名 | 具体说明 |
| --- | --- |
| **`DEFAULT_TIME_RANGE`** | - **描述**: 数据查询界面的默认时间范围选择。<br>- **关联需求**: PRD-FR2 (数据查询与分析)。<br>- **数据类型**: `string`<br>- **默认值**: `'today'`<br>- **取值范围**: `['today', 'yesterday', 'last7days', 'thisMonth', 'lastMonth']`<br>- **用户可配置**: `true`<br>- **调整策略与影响**: 调整此值可优化用户的默认查询体验，应根据用户最常用的查询模式进行设置。 |
| **`UI_THEME_DEFAULT`** | - **描述**: 用户界面的默认主题。<br>- **关联需求**: PRD-FR4A (用户配置管理)。<br>- **数据类型**: `string`<br>- **默认值**: `'auto'`<br>- **取值范围**: `['light', 'dark', 'auto']`<br>- **用户可配置**: `true`<br>- **调整策略与影响**: 'auto'主题可自动适应系统设置，提供最佳的用户体验一致性。 |

## 5. 版本与变更管理

- **版本控制**：本CSPEC文档遵循独立的版本号管理，采用语义化版本控制。
- **变更流程**：任何对参数（新增、修改、废弃）的变更都必须启动一个正式的评审流程，并评估其对现有文档体系和已部署系统的影响。

---